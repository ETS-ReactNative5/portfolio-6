var garethPortfolioControllers=angular.module("garethPortfolioControllers",[]);garethPortfolioControllers.controller("portfolioItems",["$scope","$state","$location","dataService","$sce","lastFmService","$anchorScroll","$http",function($scope,$state,$location,dataService,$sce,lastFmService,$anchorScroll,$http,message){this.state=$state.current.name,this.notSorted=function(obj){return obj?Object.keys(obj):[]};var $this=this;if(this.portfolios=!1,$(window).width()>767?this.size="full":this.size="small",window.matchMedia){var retinaQuery="(-webkit-min-device-pixel-ratio: 1.5),                             (min-resolution: 144dpi)";window.matchMedia(retinaQuery).matches&&"full"==this.size?this.size="high":window.matchMedia(retinaQuery).matches&&"small"==this.size&&(this.size="full")}$scope.isDisplayed="height:200000px",dataService.getPortfolioItems().then(function(result){$this.portfolios=result,$scope.status="ready"},function(){}),this.getLastFMAlbums=function(){lastFmService.getAlbums().then(function(albums){albums.topalbums&&($scope.albums=albums.topalbums.album)})},this.getLastFMAlbums(),this.workScroll=function(){$("body").animate({scrollTop:$("#main_content").position().top-100},"500","swing")}}]),garethPortfolioControllers.controller("workItem",["$scope","$state","$location","dataService","$sce","$http",function($scope,$state,$location,dataService,$sce,$http,message){var $this=this;if($scope.getSrc=function(target){var url="";switch(target){case"AngularJS":url="#angular";break;case"CSS3":url="#css";break;case"Responsive Design":url="#responsive";break;case"Javascript":url="#js";break;case"PHP":url="#php";break;case"Adobe Flash":url="#flash";break;case"MySQL":url="#mysql";break;case"SQL Lite":url="#database";break;case"PostgreSQL":url="#postgres";break;case"Wordpress":url="#wordpress";break;case"PayPal and Woocommerce":url="#paypal";break;case"SASS":url="#sass";break;default:url="#html5"}return url=""+url},this.notSorted=function(obj){return obj?Object.keys(obj):[]},this.portfolios=!1,$(".fancybox").fancybox(),dataService.getPortfolioItems().then(function(result){var work=$state.params.workID;$this.portfolios=result,$scope.status="ready",$this.portfolios[work]?($scope.currentItem=$this.portfolios[work],$scope.convertToHTML=function(){return $sce.trustAsHtml($scope.currentItem.desc)}):$location.path("/")},function(){}),window.matchMedia){var retinaQuery="(-webkit-min-device-pixel-ratio: 1.5),                         (min-resolution: 144dpi)";window.matchMedia(retinaQuery).matches&&"full"==this.size?this.size="high":window.matchMedia(retinaQuery).matches&&"small"==this.size&&(this.size="full")}}]),garethPortfolioControllers.controller("contactForm",["$scope","$http","emailService",function($scope,$http,emailService){$scope.formData={},$scope.submitEnquiry=function(){emailService.sendEmail($scope.formData,function(data){"success"==data.data?$scope.showSuccessMessage="true":$scope.showErrorMessage="true"},function(data){$scope.showErrorMessage="true"})}}]);var garethPortfolio=angular.module("garethPortfolio",["ui.router","ngAnimate","garethPortfolioControllers","ngSanitize","ngAria"]);garethPortfolio.config(["$stateProvider","$urlRouterProvider","$locationProvider","$ariaProvider",function($stateProvider,$urlRouterProvider,$locationProvider,$ariaProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"homepage.html",controller:"portfolioItems",controllerAs:"pI"}).state("contact",{url:"/contact",templateUrl:"contact.html",controller:"contactForm"}).state("work",{url:"/:workID",templateUrl:"work.html",controller:"workItem",controllerAs:"pI"}),$ariaProvider.config({tabindex:!0,ariaHidden:!0}),$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}]),garethPortfolio.run(["$rootScope","$http","$location","$anchorScroll",function($rootScope,$http,$location,$anchorScroll){var counterStatus="off",connectionString="http://garethferguson.co.uk:3000";-1===document.location.toString().indexOf("garethferguson.co.uk")&&(connectionString="http://portfolio.dev/3000");var socket=io.connect(connectionString,{resource:"/api/index.js"});socket.on("connect",function(){socket.send("here");var count;socket.on("count",function(msg){count=msg.count>1?"<strong>"+msg.count+"</strong> current viewers":"<strong>"+msg.count+"</strong> current viewer",$("#counter").html(count),"off"==counterStatus&&(counterStatus="on",$("#counter").addClass("visible"))})})}]),garethPortfolio.directive("menu",["$window",function($window){return{link:function(scope,element,attrs){var slideout=new Slideout({panel:document.getElementById("content"),menu:document.getElementById("menu"),padding:200,tolerance:70,fx:"ease-in-out",duration:400});document.getElementById("nav__pullDown").addEventListener("click",function(){slideout.toggle(),this.classList.toggle("active")})}}}]),garethPortfolio.directive("scroll",["$window",function($window){return{link:function(scope,element,attrs){var windowElement=angular.element($window),headerDiv=document.querySelector("#header");windowElement.bind("scroll",function(){this.pageYOffset>headerDiv.offsetHeight?element.hasClass("revealHeader")||element.addClass("revealHeader"):element.removeClass("revealHeader")})}}}]),garethPortfolio.factory("dataService",["$rootScope","$http","$q",function($rootScope,$http,$q){var portfolios,serviceObj={};return serviceObj.getPortfolioItems=function(){var deferred=$q.defer();return portfolios?(deferred.resolve(portfolios),deferred.promise):$http.get("/js/data.min.json").then(function(data){return portfolios=data.data.portfolio.Items,deferred.resolve(portfolios),deferred.promise})},serviceObj}]),garethPortfolio.directive("fancybox",["$compile","$timeout",function($compile,$timeout){return{link:function($scope,element,attrs){element.fancybox({hideOnOverlayClick:!1,hideOnContentClick:!1,showNavArrows:!0,onComplete:function(){$timeout(function(){$compile($("#fancybox-content"))($scope),$scope.$apply(),$.fancybox.resize()})}})}}}]),garethPortfolio.factory("emailService",["$rootScope","$http",function($rootScope,$http){var serviceObj={};return serviceObj.sendEmail=function(formData,callbackSuccess,callbackFailure){$http({method:"POST",url:"/api/formEmail",data:$.param(formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){callbackSuccess(data)},function(data){callbackFailure(data)})},serviceObj}]),garethPortfolio.factory("lastFmService",["$rootScope","$http","$q",function($rootScope,$http,$q){var albums,serviceObj={},deferred=$q.defer();return serviceObj.requestAlbumData=function(){return $http({method:"POST",url:"/api/lastFm",data:"name=DirtyG",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(data){return albums=data,deferred.resolve(data),deferred.promise},function(data){return deferred.resolve(data),deferred.promise})},serviceObj.getAlbums=function(){return albums?(deferred.resolve(albums),deferred.promise):serviceObj.requestAlbumData().then(function(result){return deferred.resolve(albums),deferred.promise})},serviceObj}]);
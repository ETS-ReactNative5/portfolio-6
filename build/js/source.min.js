var garethPortfolioControllers=angular.module("garethPortfolioControllers",[]);garethPortfolioControllers.controller("portfolioItems",["$scope","$routeParams","$location","dataService","$sce","lastFmService","$anchorScroll","$http",function($scope,$routeParams,$location,dataService,$sce,lastFmService,$anchorScroll,$http,message){this.tech_classes={AngularJS:"devicons devicons-angular",CSS3:"devicons devicons-css3",HTML5:"fa fa-html5","Responsive Design":"devicons devicons-responsive","JQuery & Javascript":"devicons devicons-javascript_badge",PHP:"devicons devicons-php","Adobe Flash":"fa fa-flash",MySQL:"devicons devicons-mysql","SQL Lite":"fa fa-database",PostgreSQL:"devicons devicons-postgresql",Wordpress:"fa fa-wordpress",PayPal:"fa fa-paypal",SASS:"devicons devicons-sass"},this.notSorted=function(obj){return obj?Object.keys(obj):[]};var $this=this;if(this.portfolios=!1,$(window).width()>767?this.size="full":this.size="small",window.matchMedia){var retinaQuery="(-webkit-min-device-pixel-ratio: 1.5),                             (min-resolution: 144dpi)";window.matchMedia(retinaQuery).matches&&"full"==this.size?this.size="high":window.matchMedia(retinaQuery).matches&&"small"==this.size&&(this.size="full")}dataService.getPortfolioItems().then(function(result){$this.portfolios=result,$routeParams.workID&&($this.portfolios[$routeParams.workID]?($scope.currentItem=$this.portfolios[$routeParams.workID],$scope.convertToHTML=function(){return $sce.trustAsHtml($scope.currentItem.desc)}):$location.path("/")),$scope.status="ready"},function(){}),$(".fancybox").fancybox(),this.getLastFMAlbums=function(){lastFmService.getAlbums().then(function(albums){$scope.albums=albums.topalbums.album})},this.getLastFMAlbums(),this.workScroll=function(){$("body").animate({scrollTop:$("#main_content").position().top-100},"500","swing")}}]),garethPortfolioControllers.controller("contactForm",["$scope","$http","emailService",function($scope,$http,emailService){$scope.formData={},$scope.submitEnquiry=function(){emailService.sendEmail($scope.formData,function(data){"success"==data?$scope.showSuccessMessage="true":$scope.showErrorMessage="true"},function(data){$scope.showErrorMessage="true"})}}]);var garethPortfolio=angular.module("garethPortfolio",["ngRoute","ngAnimate","garethPortfolioControllers","ngSanitize","ngAria"]);garethPortfolio.config(["$routeProvider","$locationProvider","$ariaProvider",function($routeProvider,$locationProvider,$ariaProvider){$routeProvider.when("/",{templateUrl:"/homepage.html",controller:"portfolioItems",controllerAs:"pI"}).when("/my_work",{templateUrl:"/homepage.html",controller:"portfolioItems",controllerAs:"pI"}).when("/contact",{templateUrl:"/contact.html",controller:"contactForm"}).when("/:workID",{templateUrl:"/work.html",controller:"portfolioItems",work:"yes",controllerAs:"pI"}).otherwise({redirectTo:"/"}),$ariaProvider.config({tabindex:!0,ariaHidden:!0}),$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}]),garethPortfolio.run(["$rootScope","$location","$anchorScroll","$routeParams",function($rootScope,$location,$anchorScroll,$routeParams){var counterStatus="off",connectionString="http://garethferguson.co.uk:3000";document.location.toString().indexOf("garethferguson.co.uk")===-1&&(connectionString="http://local.gareth.com:3000"),console.log("now");var socket=io.connect(connectionString,{resource:"/api/index.js"});socket.on("connect",function(){socket.send("here");var count;socket.on("count",function(msg){count=msg.count>1?"<strong>"+msg.count+"</strong> current viewers":"<strong>"+msg.count+"</strong> current viewer",$("#counter").html(count),"off"==counterStatus&&(counterStatus="on",$("#counter").addClass("visible"))})})}]),garethPortfolio.directive("scroll",["$window",function($window){return{link:function(scope,element,attrs){var windowElement=angular.element($window),headerDiv=document.querySelector("#header");windowElement.bind("scroll",function(){this.pageYOffset>headerDiv.offsetHeight?element.hasClass("revealHeader")||element.addClass("revealHeader"):element.removeClass("revealHeader")})}}}]),garethPortfolio.factory("dataService",["$rootScope","$http","$q",function($rootScope,$http,$q){var portfolios,allJSON,serviceObj={};return serviceObj.requestPortfolioData=function(){return $http.get("/js/data.min.json").success(function(data){allJSON=data})},serviceObj.getPortfolioItems=function(){var deferred=$q.defer();return portfolios?(deferred.resolve(portfolios),deferred.promise):serviceObj.requestPortfolioData().then(function(result){return portfolios=result.data.portfolio.Items,deferred.resolve(portfolios),deferred.promise})},serviceObj}]),garethPortfolio.directive("fancybox",["$compile","$timeout",function($compile,$timeout){return{link:function($scope,element,attrs){element.fancybox({hideOnOverlayClick:!1,hideOnContentClick:!1,showNavArrows:!0,onComplete:function(){$timeout(function(){$compile($("#fancybox-content"))($scope),$scope.$apply(),$.fancybox.resize()})}})}}}]),garethPortfolio.factory("emailService",["$rootScope","$http",function($rootScope,$http){var serviceObj={};return serviceObj.sendEmail=function(formData,callbackSuccess,callbackFailure){$http({method:"POST",url:"/api/formEmail",data:$.param(formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){callbackSuccess(data)}).error(function(data){callbackFailure(data)})},serviceObj}]),garethPortfolio.factory("lastFmService",["$rootScope","$http","$q",function($rootScope,$http,$q){var albums,serviceObj={},deferred=$q.defer();return serviceObj.requestAlbumData=function(){return $http({method:"POST",url:"/api/lastFm",data:"name=DirtyG",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){return albums=data,deferred.resolve(data),deferred.promise}).error(function(data){return deferred.resolve(data),deferred.promise})},serviceObj.getAlbums=function(){return albums?(deferred.resolve(albums),deferred.promise):serviceObj.requestAlbumData().then(function(result){return deferred.resolve(albums),deferred.promise})},serviceObj}]);